
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:insert="~{layout :: head}"></head>
<body>
<!-- Navigation -->
<nav th:insert="~{layout :: nav}"></nav>


<div class="container">
  <div class="main-container">

    <!-- Header Section -->
    <div class="header-section">
      <button type="button" class="btn btn-primary" onclick="window.location.href='\/'">
        <i class="fas fa-arrow-left"></i>
        Back to Lists
      </button>
      <h1 class="header-title" th:text="${todoList != null ? todoList.name : 'Todo List'}">
        Todo List Name
      </h1>
      <button class="btn btn-primary" onclick="openModal('addTodoModal')">
        <i class="fas fa-plus"></i>
        Add Todo
      </button>
    </div>

    <!-- Filter Buttons -->
    <div class="filter-section">
      <a href="#" th:href="@{/templates/pages/lists/{id}(id=${todoList.id})}"
         class="btn btn-outline-secondary btn-sm"
         th:classappend="${currentFilter == null ? 'active' : ''}">
        All
      </a>
      <a href="#" th:href="@{/templates/pages/lists/{id}(id=${todoList.id}, filter='pending')}"
         class="btn btn-outline-warning btn-sm"
         th:classappend="${currentFilter == 'pending' ? 'active' : ''}">
        Pending
      </a>
      <a href="#" th:href="@{/templates/pages/lists/{id}(id=${todoList.id}, filter='completed')}"
         class="btn btn-outline-success btn-sm"
         th:classappend="${currentFilter == 'completed' ? 'active' : ''}">
        Completed
      </a>
    </div>

    <!-- No todos message -->
    <div th:if="${not hasTodos}" class="empty-state">
      <i class="fas fa-clipboard-list"></i>
      <h4>No todos yet</h4>
      <p>Add your first todo to get started!</p>
    </div>

    <!-- No filtered todos message -->
    <div th:if="${hasTodos and (todos == null or #lists.isEmpty(todos))}" class="empty-state">
      <i class="fas fa-clipboard-list"></i>
      <h4 th:switch="${currentFilter}">
        <span th:case="'pending'">No pending todos</span>
        <span th:case="'completed'">No completed todos</span>
      </h4>
      <p th:switch="${currentFilter}">
        <span th:case="'pending'">All your todos are completed! ðŸŽ‰</span>
        <span th:case="'completed'">Complete some todos to see them here.</span>
      </p>
    </div>

    <!-- Todos List -->
    <div class="todo-list" th:if="${todos != null and not #lists.isEmpty(todos)}">
      <div class="todo-item" th:each="todo : ${todos}" th:if="${todo != null}">
        <div class="todo-content">
          <form th:action="@{/templates/pages/lists/{listId}/todos/{todoId}/toggle(listId=${todoList.id}, todoId=${todo.id})}"
                method="post" class="todo-toggle">
            <button type="submit" class="btn btn-link">
              <i class="fas fa-check-circle text-success" th:if="${todo.completed}"></i>
              <i class="far fa-circle text-muted" th:unless="${todo.completed}"></i>
            </button>
          </form>
          <span class="todo-text"
                th:text="${todo.description}"
                th:classappend="${todo.completed ? 'completed' : ''}">
              Todo description
          </span>
        </div>
        <div class="todo-actions">
          <button class="btn btn-sm btn-outline-primary edit-todo-btn"
            th:attr="data-list-id=${todoList.id}, data-todo-id=${todo.id}, data-description=${todo.description}">
            <i class="fas fa-edit"></i>
          </button>
          <form th:action="@{/templates/pages/lists/{listId}/todos/{todoId}/delete(listId=${todoList.id}, todoId=${todo.id})}"
                method="post" style="display: inline;">
            <button type="submit" class="btn btn-outline-danger btn-sm"
                    onclick="return confirmDelete('Are you sure you want to delete this todo?')">
              <i class="fas fa-trash"></i>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Todo Modal -->
<div class="modal" id="addTodoModal">
  <div class="modal-dialog">
    <form th:action="@{/templates/pages/lists/{listId}/todos(listId=${todoList.id})}" th:object="${newTodo}" method="post">
      <div class="modal-header">
        <h5 class="modal-title">Add New Todo</h5>
        <button type="button" class="btn-close" onclick="closeModal('addTodoModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="todoDescription" class="form-label">Description</label>
          <input type="text"
                 class="form-control"
                 id="todoDescription"
                 th:field="*{description}"
                 placeholder="Enter todo description"
                 required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal('addTodoModal')">Cancel</button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-plus"></i>
          Add Todo
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Todo Modal -->
<div class="modal" id="editTodoModal">
  <div class="modal-dialog">
    <form id="editTodoForm" method="post">
      <div class="modal-header">
        <h5 class="modal-title">Edit Todo</h5>
        <button type="button" class="btn-close" onclick="closeModal('editTodoModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="editTodoDescription" class="form-label">Description</label>
          <input type="text"
                 class="form-control"
                 id="editTodoDescription"
                 name="description"
                 placeholder="Enter todo description"
                 required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal('editTodoModal')">Cancel</button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save"></i>
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.edit-todo-btn').forEach(button => {
        button.addEventListener('click', function() {
            // Read the data from the clicked button
            const listId = this.getAttribute('data-list-id');
            const todoId = this.getAttribute('data-todo-id');
            const description = this.getAttribute('data-description');

            // Set up the modal form
            const form = document.getElementById('editTodoForm');
            const input = document.getElementById('editTodoDescription');

            // Set form action with the specific IDs
            form.action = `/lists/${listId}/todos/${todoId}/update`;
            input.value = description;

            openModal('editTodoModal');
        });
    });
});
</script>
</body>
</html>